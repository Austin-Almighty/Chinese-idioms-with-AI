# 成語遊戲 RAG Benchmark 自動化評估系統

## 專案概述

本專案旨在建立一個自動化流程，用於評估「檢索增強生成 (RAG)」在「互動式成語遊戲」中提供選項的品質。

## 環境設定

### 1. 安裝依賴套件

```bash
pip install -r requirements.txt
```

### 2. 設定 API Key

建立 `.env` 檔案（參考 `.env.example`），並填入您的 Google API Key：

```
GOOGLE_API_KEY=your_google_api_key_here
```

## 專案結構

```
.
├── 規劃書.md                  # 專案規格書
├── idiom_dataset.json         # 成語資料庫
├── 情境.json                  # 情境定義（新格式，支援多情境）
├── scenario.json              # 情境定義（舊格式，單一情境，向後相容）
├── step1_generate_draft.py    # Step 1: 候選生成
├── step3_run_eval.py          # Step 3: 實驗與評估（待實作）
├── benchmark_draft_*.json     # Step 1 輸出（自動生成，每個情境一個檔案）
├── benchmark_final.json        # Step 2 人工處理後的黃金標準
├── requirements.txt            # Python 依賴套件
└── README.md                   # 本檔案
```

## 使用方式

### Step 1: 候選生成

執行以下指令生成候選成語：

```bash
python step1_generate_draft.py
```

此步驟會：
1. 自動偵測並讀取 `情境.json`（優先）或 `scenario.json` 和 `idiom_dataset.json`
2. 為每個情境生成 **三種策略類型**的候選成語，每種類型 **10 個**，總共 **30 個**：
   - **最佳解（明智/樂觀）**：10 個候選成語
   - **最差解（愚蠢/負面）**：10 個候選成語
   - **不定解（中立/高風險）**：10 個候選成語
3. 輸出結果：
   - 多情境格式：每個情境生成一個 `benchmark_draft_情境X.json` 檔案
   - 單一情境格式：輸出到 `benchmark_draft.json`
   - 每個輸出檔案包含按策略類型分組的候選成語

**批次處理說明：**
- 如果情境檔案包含多個情境（如 `情境.json`），程式會詢問是否要處理所有情境
- 可以選擇處理特定情境（例如：輸入 `1,3,5` 或 `1-5`）
- 每個情境會獨立生成一個輸出檔案
- **注意**：每個情境需要生成 3 種策略類型 × 10 個成語 = 30 個候選，處理時間會較長

### Step 2: 人工介入

手動編輯 `benchmark_draft_*.json` 檔案，從每個策略類型的 10 個候選成語中，篩選出最佳選項並整理成 `benchmark_final.json`（黃金標準）。

**人工篩選目標：**
- 從「最佳解（明智/樂觀）」的 10 個候選中選出 1 個最佳選項
- 從「最差解（愚蠢/負面）」的 10 個候選中選出 1 個最佳選項
- 從「不定解（中立/高風險）」的 10 個候選中選出 1 個最佳選項

最終每個情境應有 3 個成語選項（三種策略類型各 1 個）。

### Step 3: 實驗與評估

（待實作）

## 資料格式

### 成語資料庫 (idiom_dataset.json)

```json
[
  {
    "idiom": "聲東擊西",
    "meaning": "表面聲張在東，實則擊西。",
    "tags": ["明智", "計謀"]
  }
]
```

### 情境定義

**新格式（多情境，推薦使用）：`情境.json`**

```json
{
  "情境1": {
    "角色": "一般民眾",
    "故事內容/衝突": "在便利商店準備結帳時才發現沒有帶錢包..."
  },
  "情境2": {
    "角色": "消費者",
    "故事內容/衝突": "到餐廳用餐時，服務生告訴你今天完全沒有你原本想點的餐點..."
  }
}
```

**舊格式（單一情境，向後相容）：`scenario.json`**

```json
{
  "id": "SCN_001",
  "theme": "武俠",
  "conflict": "師父重傷，敵方大軍壓境，我方人手不足。",
  "goal": "保全門派",
  "constraints": ["敵強我弱", "時間緊迫"]
}
```

## 注意事項

- 請確保已設定正確的 Google API Key
- 使用 `gemini-2.0-flash-exp` 模型（可在程式碼中修改）
- 所有 JSON 檔案使用 UTF-8 編碼

